<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Fulfilled Orders</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; background-color: #f5f5f7; color: #1d1d1f; }
        .container { padding: 40px; }
        h1 { font-size: 2.5em; margin-bottom: 40px; }
        .card { background-color: #ffffff; border-radius: 12px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h2 { font-size: 1.5em; border-bottom: 1px solid #e5e5e5; padding-bottom: 10px; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #e5e5e5; }
        th { font-weight: 600; }
        a { color: #007aff; text-decoration: none; }
        .nav-link { display: inline-block; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fulfilled Orders</h1>

        <div class="card">
            <h2>Completed Orders</h2>
            <table>
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Items</th>
                        <th>Total Amount</th>
                        <th>Discount</th>
                        <th>Fulfilled Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="order : ${orders}">
                        <td>
                            <a th:href="@{'/admin/orders/' + ${order.id}}" style="font-weight: 600; color: #007aff;">
                                #<span th:text="${order.id}"></span>
                            </a>
                        </td>
                        <td>
                            <div th:text="${order.username}" style="font-weight: 500;"></div>
                            <small th:text="${order.customerEmail}" style="color: #666; font-size: 0.85em;"></small>
                        </td>
                        <td>
                            <div style="font-weight: 500;" th:text="${order.totalItems} + ' items'"></div>
                            <div style="font-size: 0.85em; color: #666; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                <span th:each="item, iterStat : ${order.orderItems}">
                                    <span th:text="${item.quantity + 'x ' + item.fruitName}"></span>
                                    <span th:if="${!iterStat.last && iterStat.index < 2}" th:text="', '"></span>
                                    <span th:if="${iterStat.index >= 2 && !iterStat.last}">...</span>
                                    <span th:if="${iterStat.index >= 2}" style="display: none;"></span>
                                </span>
                            </div>
                        </td>
                        <td>
                            <div th:if="${order.hasDiscount()}" style="text-decoration: line-through; color: #999; font-size: 0.85em;">
                                $<span th:text="${#numbers.formatDecimal(order.originalAmount, 1, 2)}"></span>
                            </div>
                            <div style="font-weight: 600;" th:text="${'$' + #numbers.formatDecimal(order.totalAmount, 1, 2)}"></div>
                        </td>
                        <td>
                            <div th:if="${order.hasDiscount()}" style="color: #28a745; font-size: 0.85em;">
                                <div th:text="${order.couponCode}"></div>
                                <div>-$<span th:text="${#numbers.formatDecimal(order.discountAmount, 1, 2)}"></span></div>
                            </div>
                            <div th:unless="${order.hasDiscount()}" style="color: #999; font-size: 0.85em;">
                                No discount
                            </div>
                        </td>
                        <td>
                            <div th:text="${#temporals.format(order.fulfilledDate ?: order.orderDate, 'MMM dd, yyyy')}"></div>
                            <div style="font-size: 0.85em; color: #666;" th:text="${#temporals.format(order.fulfilledDate ?: order.orderDate, 'HH:mm')}"></div>
                        </td>
                        <td>
                            <a th:href="@{'/admin/orders/' + ${order.id}}" 
                               style="background-color: #007aff; color: white; border: none; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 0.85em;">
                                View Details
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <a href="/admin" class="nav-link">Back to Admin Panel</a>
    </div>
</body>
</html> 